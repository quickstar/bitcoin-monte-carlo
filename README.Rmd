---
title: "Monte Carlo analysis of Bitcoin"
author: "Lukas LÃ¤derach"
output: html_notebook
---
# Abstract
This document describes the process of modeling a bitcoin monte carlo chart.


# Prerequisites
To follow along this notebook make sure the following R-Packages are installed globally.

```{r}
# Quandl - Get millions of financial and economic datasets from hundreds of publishers directly into R.
install.packages("Quandl")
# ggplot2 is a plotting system for R, based on the grammar of graphics.
install.packages("ggplot2")
```

Once those packages are installed import them into your current workspace and set your Quandl API-Key (You have to create an account at [Quandl](https://www.quandl.com/sign-up-modal?defaultModal=showSignUp)).

```{r}
library(Quandl)
library(ggplot2)

Quandl.api_key("CYyznmeKqzV2GxrHZMxD")
```

Once everthing is set up correctly you should be able retrieve financial data via Quandl.

For example the following statement will retrieve all the BTC/USD starting from 2017-12-31 to the very recent.

```{r}
data <- Quandl("BITFINEX/BTCUSD", start_date="2017-12-31")
head(data)
```

To generate a plot visualizing the closing price according to it's date (column labeled *Last*) we can specify which columns to retrieve via the column_index parameter (0 is always the *Date* column). To specifiy multiple columns we can also create a vector e.g. *c(4,6)* - this would return a table containing the *Date*, *Last* and *Ask* columns only.

```{r}
data <- Quandl("BITFINEX/BTCUSD", start_date="2011-12-31", column_index=4)
gg <- ggplot(data, aes(Date, Last)) +
  geom_line() +
  geom_smooth(method = "lm") +
  labs(title="Bitcoin price",
       y="Closing price in USD",
       caption="Source: bitfinex")
plot(gg)
```


# Introduction

## Brownian Motion
**Main Idea** - There are two parts to random movement
  
  * Deterministic Component, known as Drift
  * Stochastic Component, known as Random Shock

```
Future Price = Today's Price * Continuous Growth over time + The volatility of People randomly trading over time
```

```{R}
gg = Quandl("BITFINEX/BTCUSD", start_date="2011-12-31", transform = "rdiff")
lmtRets = gg$Last
mu = mean(lmtRets) # also knwon as Drift
sigma = sd(lmtRets)

nSim = 1000
nDays = 365
S0 <- head(Quandl("BITFINEX/BTCUSD", start_date="2018-5-1"), n=1)$Last
S = matrix(0,nrow=nDays,ncol=nSim)

for (i in 1:nSim) {
  SVec = rep(0, nDays)
  SVec[1] = S0
  for(j in 2:nDays) {
    pastDay = SVec[j-1]
    DeltaS = mu*pastDay + sigma*pastDay*rnorm(1)
    SVec[j] = pastDay+DeltaS
  }
  S[,i] = SVec
}
matplot(S, type='l',col=rgb(0,0,1,0.3), lty=1,ylab="", main="Simulation Price of Bitcoin")

lnMean = S0*exp(mu*nDays)
lnSD = S0*exp(mu*nDays)*sqrt(exp((sigma^2)*nDays)-1)
cat(lnMean,mean(S[nDays,]))
cat(lnSD,sd(S[nDays,]))

meanOfLog = log(S0) + (mu-(sigma^2)/2)*nDays
sdOfLog = sigma*sqrt(nDays)
priceGrid = seq(0,lnMean+6*lnSD,length=10000)
theoreticalDens = dlnorm(priceGrid,meanOfLog,sdOfLog)
empiricalDens = density(S[nDays,])

plot(priceGrid,theoreticalDens,type='l',xlab='Prices',ylab='Density')
lines(empiricalDens,col='blue')
```


## Drift

# Methods

# Results